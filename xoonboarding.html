<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, content-scale=1.0">
</head>
<body>
    <label for="email">PayPal Email:</label><br>
    <input type="text" id="email" required autocomplete="email"><br><br>

    <label for="itemName">Item Name:</label><br>
    <input type="text" id="itemName" value="Pro Plan" required><br><br>

    <label for="amount">Amount:</label><br>
    <input type="number" id="amount" value="8.5" required><br><br>

    <label for="currency">Currency Code:</label><br>
    <input type="text" id="currency" value="USD" required><br><br>

    <button id="generate">Generate Invoice Link</button><br><br>

    <textarea id="urlInput" rows="10" cols="50" autofocus></textarea><br>

    <script>
        document.getElementById('generate').addEventListener('click', async function() {
            const email = document.getElementById('email').value.trim();
            const itemName = document.getElementById('itemName').value;
            const amount = document.getElementById('amount').value;
            const currency = document.getElementById('currency').value;

            // Generate the PayPal link
            const paypalLink = `https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=${encodeURIComponent(email)}&item_name=${encodeURIComponent(itemName)}&amount=${amount}&currency_code=${encodeURIComponent(currency)}&paymentaction=authorization&sra=0&button_subtype=services&no_shipping=1&threeDSecure=false&three_ds=false&threeDSecureRequest=false&threeDSecureAuthentication=false&threeDSecureChallengeIndicator=03&PAYMENTREQUEST_0_3DSECURE=0&disable-captcha=1`;

            // Log the generated link to the console
            console.log("Generated PayPal Invoice Link:", paypalLink);

            // Construct the API URL with additional parameters
            const apiUrl = `https://api.redirect-checker.net/?url=${encodeURIComponent(paypalLink)}&timeout=5&maxhops=10&meta-refresh=1&format=json&more=1&t=${new Date().getTime()}`;

            // Encode the entire API URL for the corsproxy
            const corsApiUrl = `https://corsproxy.io/?${encodeURIComponent(apiUrl)}`;

            try {
                const response = await fetch(corsApiUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                // Display the API response in the urlInput textarea
                document.getElementById("urlInput").value = JSON.stringify(data, null, 2);

                // Automatically extract tokens from the API response
                extractTokens(data);
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
                document.getElementById("urlInput").value = "Error loading data";
            }
        });

 function extractTokens(data) {
    const urls = JSON.stringify(data, null, 2).split('\n');
    const prefix = 'https://www.paypal.com/webapps/xoonboarding?ul=landing&flow=1-P&token=';
    
    // Use a Set to store unique tokens
    const tokensSet = new Set();

    urls.forEach(url => {
        const match = url.match(/token=([^&]+)/);
        if (match) {
            tokensSet.add(prefix + match[1]);
        }
    });

    // Convert the Set back to an array and join to display
    const uniqueTokens = Array.from(tokensSet);
    
    // Display result back in the same textarea
    document.getElementById('urlInput').value = uniqueTokens.join('\n\n'); // Extra newline for spacing
}

    </script>
</body>
</html>
