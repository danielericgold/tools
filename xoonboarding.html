<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, content-scale=1.0">
</head>
<body>
    <label for="email">PayPal Email:</label><br>
    <input type="text" id="email" placeholder="Enter your PayPal email" required><br><br>

    <label for="itemName">Item Name:</label><br>
    <input type="text" id="itemName" value="Book" placeholder="Enter item name" required><br><br>

    <label for="amount">Amount:</label><br>
    <input type="number" id="amount" value="8.5" placeholder="Enter amount" required><br><br>

    <label for="currency">Currency Code:</label><br>
    <input type="text" id="currency" value="USD" placeholder="Enter currency code (e.g., USD)" required><br><br>

    <button id="generate">Generate Invoice Link</button><br><br>

    <textarea id="urlInput" rows="10" cols="50" placeholder="API response or PayPal URLs will appear here..." autofocus></textarea><br>

    <script>
        document.getElementById('generate').addEventListener('click', async function() {
            const email = document.getElementById('email').value.trim(); // Trim spaces from email only
            const itemName = document.getElementById('itemName').value; // No trimming
            const amount = document.getElementById('amount').value; // No trimming
            const currency = document.getElementById('currency').value; // No trimming

            // Generate the PayPal link
            const paypalLink = `https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=${encodeURIComponent(email)}&item_name=${encodeURIComponent(itemName)}&amount=${amount}&currency_code=${encodeURIComponent(currency)}`;

            // Log the generated link to the console
            console.log("Generated PayPal Invoice Link:", paypalLink);

            // Fetch the final URL using the provided API
            const apiUrl = `https://45c7bf25-ac52-4dab-b357-23c5206d07e1-00-2c26u0qcc5h37.worf.replit.dev/?url=${encodeURIComponent(paypalLink)}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                // Display the API response in the urlInput textarea
                document.getElementById("urlInput").value = JSON.stringify(data, null, 2);

                // Automatically extract tokens from the API response
                extractTokens();
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
                document.getElementById("urlInput").value = "Error loading data";
            }
        });

        function extractTokens() {
            const urls = document.getElementById('urlInput').value.split('\n');
            const prefix = 'https://www.paypal.com/webapps/xoonboarding?ul=landing&flow=1-P&token=';
            const tokens = urls.map(url => {
                const match = url.match(/token=([^&]+)/);
                return match ? prefix + match[1] : '';
            }).filter(Boolean);
            
            // Display result back in the same textarea
            document.getElementById('urlInput').value = tokens.join('\n\n'); // Extra newline for spacing
        }
    </script>
</body>
</html>
