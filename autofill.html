<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const textarea = document.getElementById('textarea');
            const form = document.getElementById('form');
            const countryInput = form.querySelector('[name="country"]');
            const countryCache = {};

            async function fetchCountry(city, state) {
                const cacheKey = `${city}-${state}`;
                if (countryCache[cacheKey]) {
                    return countryCache[cacheKey];
                }

                const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(city)},${encodeURIComponent(state)}&format=json&addressdetails=1`;
                try {
                    const response = await fetch(url);
                    const result = await response.json();
                    if (result.length > 0) {
                        const country = result[0].address.country;
                        countryCache[cacheKey] = country;
                        return country;
                    }
                } catch (error) {
                    console.error('Error fetching country data:', error);
                }
                return null;
            }

            textarea.addEventListener('paste', async (event) => {
                event.preventDefault();
                const pastedData = (event.clipboardData || window.clipboardData).getData('text');
                const data = Object.fromEntries(pastedData.split('\n').map(line => line.split(':').map(part => part.trim())));

                for (const [key, value] of Object.entries(data)) {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        input.value = value;
                    }
                }

                const addressNameInput = form.querySelector('[name="name"]');
                if (addressNameInput && !addressNameInput.value && data['cc-name']) {
                    addressNameInput.value = data['cc-name'];
                }

                const emailInput = form.querySelector('[name="email"]');
                if (emailInput && !emailInput.value && data['cc-name']) {
                    const sanitized = data['cc-name'].toLowerCase().replace(/[^a-z0-9]/g, '');
                    const randomDigits = Math.floor(1000 + Math.random() * 9000);
                    emailInput.value = `${sanitized}${randomDigits}@gmail.com`;
                }

                const state = data['address-level1']?.trim();
                const city = data['address-level2']?.trim();
                if (countryInput && !countryInput.value && city && state) {
                    const country = await fetchCountry(city, state);
                    countryInput.value = country || ''; // Leave empty if country not found
                }
            });

            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.shiftKey && event.altKey && event.key === 'F12') {
                    event.preventDefault();
                    form.submit();
                }
            });
        });
    </script>
</head>
<body>
    <form id="form" action="" method="GET">
        <textarea id="textarea" placeholder="Enter text here..." autofocus></textarea><br><br>
        <fieldset>
            <input type="text" name="cc-name" placeholder="cc-name" required><br><br>
            <input type="text" name="cc-number" placeholder="cc-number" required><br><br>
            <input type="text" name="cc-exp" placeholder="cc-exp" required><br><br>
            <input type="text" name="cc-csc" placeholder="cc-csc" required><br><br>
            <input type="text" name="country" placeholder="country"><br><br>
            <input type="text" name="name" placeholder="name" required><br><br>
            <input type="text" name="street-address" placeholder="street-address" required><br><br>
            <input type="text" name="address-level2" placeholder="address-level2" required><br><br>
            <input type="text" name="address-level1" placeholder="address-level1" required><br><br>
            <input type="text" name="postal-code" placeholder="postal-code" required><br><br>
            <input type="tel" name="tel" placeholder="tel" required><br><br>
            <input type="email" name="email" placeholder="email" required>
        </fieldset><br>
        <button type="submit">Submit</button>
    </form>
</body>
</html>
